#pragma once

namespace Gallery
{
    static const ShaderID s_SID_0 = {0xdf,0xe5,0x0f,0x72,0x5f,0xfa,0x13,0x4f,0x98,0x50,0xd9,0x50,0x25,0x64,0xc1,0x54,0xe8,0xec,0xbc,0x17,0xc8,0x2e,0xf0,0xfc,0xda,0x28,0x14,0xe6,0x8c,0x1a,0x25,0x19};
    static const ShaderID s_SID_1 = {0x08,0xb4,0xb7,0x2f,0xb5,0xd7,0x60,0x31,0x29,0x01,0x75,0x82,0x36,0x59,0x86,0xee,0xcc,0x13,0x61,0x35,0x31,0xc4,0x0b,0x28,0xc2,0xc4,0x5b,0x3d,0x37,0x29,0x3c,0xf1};
    static const ShaderID s_SID_2 = {0xe7,0x45,0x6c,0xe8,0x6f,0x86,0x90,0x6a,0xab,0x0e,0x6a,0x7e,0xe5,0x77,0x79,0x92,0x0a,0xfa,0x32,0xfe,0x9c,0x5c,0x72,0x37,0x0f,0x15,0x47,0xda,0x7d,0x48,0xc4,0x35};
    static const ShaderID s_SID_3 = {0x96,0x03,0xff,0x4c,0x5c,0xa2,0xe9,0xdc,0x1d,0xb7,0x3d,0x01,0x37,0x41,0xde,0x8b,0x70,0xf1,0xe3,0xbe,0x2d,0x3d,0xe0,0x7f,0xd8,0x1e,0x99,0x92,0xd2,0x58,0xd3,0x6b};
    static const ShaderID s_SID_4 = {0x01,0xb5,0xc0,0x6d,0x69,0x4a,0x56,0xe2,0xc5,0xf8,0xea,0xef,0xb5,0xa1,0xf6,0xbd,0xc5,0xc1,0xb2,0x17,0xa5,0x84,0x3d,0xe2,0x4c,0x61,0xa1,0xf7,0x7b,0xc9,0xa9,0xfa};
    static const ShaderID s_SID_5 = {0x62,0xb1,0x94,0x7a,0xcd,0xfc,0x56,0x56,0xee,0x63,0xbd,0x1f,0x39,0x7e,0xcc,0x13,0x0b,0xb8,0x34,0x11,0xb7,0x6b,0xdd,0x95,0x5c,0xe2,0x59,0x2a,0x52,0x1b,0xc8,0x7f};
    static const ShaderID s_SID_6 = {0xb1,0x27,0x40,0x18,0x53,0xc5,0xcc,0xd1,0x31,0xa8,0x19,0x51,0xdc,0x70,0x18,0x42,0x0d,0x54,0x42,0x95,0x37,0x10,0xeb,0xb0,0xaf,0x4c,0xcc,0x31,0xba,0xa1,0x36,0x54};
    static const ShaderID s_SID_7 = {0x02,0xf3,0xe3,0x2b,0x74,0xab,0xac,0xf9,0x73,0x46,0x6d,0xe1,0xdb,0x3d,0x30,0x29,0x01,0xe4,0xda,0xdf,0xe1,0xe0,0xf5,0xcf,0xea,0x0d,0x5c,0xac,0x6a,0xa0,0x0b,0x33};
    static const ShaderID s_SID_8 = {0xe7,0xd3,0x4b,0x28,0xdc,0x58,0x4a,0x32,0x14,0xe5,0x45,0x3a,0x72,0x56,0x44,0x56,0xe1,0x6c,0xfd,0x4c,0x56,0x85,0x6f,0x75,0x21,0xe6,0xf6,0x6e,0x66,0xc4,0x24,0x72};
    static const ShaderID s_SID_9 = {0xef,0x4c,0x21,0xa6,0x98,0x08,0x83,0x3e,0xed,0xfa,0xb7,0x62,0x1e,0x57,0xe9,0x4c,0xb3,0x32,0x03,0xdf,0xf1,0xe4,0xb3,0xaf,0x9a,0x60,0x8d,0x92,0x7b,0xf7,0x0b,0x82};
    static const ShaderID s_SID_10 = {0x3c,0x41,0xad,0x6f,0xc3,0x8f,0x80,0xdf,0x64,0x7a,0x91,0x6b,0x88,0xc6,0xb6,0x63,0xd4,0xd2,0x33,0xa6,0x15,0xae,0x9b,0xf5,0x93,0x93,0x1e,0x67,0x63,0xba,0xfb,0xfd};
    static const ShaderID s_SID_11 = {0xdb,0x5c,0x5c,0xf1,0x5b,0x28,0xf8,0xc5,0x04,0x85,0xe2,0x73,0x10,0x70,0x1c,0x63,0x63,0x7b,0x2f,0xaa,0x35,0x93,0x1a,0xbb,0xb4,0x46,0xa0,0x4e,0x69,0x86,0x20,0xc8};
    static const ShaderID s_SID_12 = {0x0a,0x82,0xb0,0x45,0x20,0x0f,0x9a,0xbf,0x27,0x73,0x6f,0x29,0x98,0x0a,0xa8,0x05,0x04,0xc3,0x74,0x13,0xa6,0x06,0xb7,0x47,0x85,0x9c,0xca,0x96,0x38,0xb9,0xe3,0xcc};
    static const ShaderID s_SID_13 = {0xc7,0x42,0xb2,0x15,0x96,0x8a,0x6d,0xb6,0x04,0xed,0xff,0x94,0xe1,0xce,0x68,0x61,0xd8,0xc3,0xbd,0x7a,0xb9,0x54,0xd9,0xe6,0x69,0xd1,0xcb,0x70,0xa7,0x96,0x3b,0x7c};
    static const ShaderID s_SID_14 = {0x7f,0x24,0x14,0x96,0x9e,0x21,0xfe,0x18,0xbe,0xf9,0x2c,0x8f,0xf7,0xb2,0xe7,0x15,0x52,0x5e,0x18,0x24,0x2a,0xf9,0xd6,0x34,0x13,0xb4,0x52,0x4e,0xa7,0xf5,0x2f,0xb1};
    static const ShaderID s_SID_15 = {0x95,0x33,0xc3,0x67,0xe6,0xa2,0xbf,0xe2,0xab,0xab,0x8a,0x40,0x67,0x77,0xb0,0xe9,0xcb,0xa2,0x9f,0x9e,0xea,0x35,0x43,0x8e,0xbb,0xf9,0x39,0x09,0x01,0x1a,0xba,0x20};
    static const ShaderID s_SID_16 = {0x28,0x28,0x6c,0x4a,0x98,0x77,0x5c,0x3b,0x9f,0x7b,0xa0,0x95,0xb4,0xde,0x31,0xdc,0xfd,0x82,0x6b,0x3c,0x15,0x93,0x2f,0x06,0x3c,0x65,0x43,0xca,0x79,0xbc,0x98,0x9d};
    static const ShaderID s_SID_17 = {0x9b,0xee,0xba,0x72,0x2e,0x06,0x09,0xc4,0xfd,0x72,0x3f,0x95,0x17,0x3a,0x8a,0xbb,0x4e,0xef,0xc3,0x96,0x5b,0xdc,0xbe,0xdd,0xfb,0xd7,0x28,0x87,0xab,0xc9,0xf6,0x87};
    static const ShaderID s_SID_18 = {0x3e,0xeb,0x78,0xea,0x39,0x2b,0x77,0x78,0xe8,0xf3,0xa4,0x0b,0xaa,0x9d,0x02,0x8c,0x20,0x20,0x91,0x04,0xfc,0x0f,0x9f,0xa4,0x72,0x87,0xaf,0xc0,0xd6,0x9f,0xaa,0x05};
    static const ShaderID s_SID_19 = {0x72,0x14,0xe3,0xee,0x60,0x96,0xa1,0x0a,0x1c,0xe0,0x59,0x2c,0x64,0x17,0x6b,0x49,0x22,0x3d,0x08,0xbe,0xcc,0x0e,0x8c,0xca,0x36,0xc1,0xc0,0x5b,0xb8,0x71,0x77,0xbb};
    static const ShaderID s_SID_20 = {0x33,0xb3,0x1e,0x9d,0xb2,0xa4,0xf1,0xda,0x64,0x06,0x72,0xe5,0x07,0x93,0xac,0x1a,0x04,0x4b,0xb6,0x20,0x17,0x9d,0xbe,0x19,0xa0,0x9e,0x74,0xf7,0xc1,0x5c,0xc4,0xf9};
    static const ShaderID s_SID_21 = {0x02,0xf9,0x7d,0xa3,0x2f,0xd6,0xf4,0x32,0x0d,0xb8,0xaa,0x97,0xcc,0xd6,0x19,0x23,0x4f,0x3a,0x7f,0xc6,0x29,0x97,0xd9,0xca,0xb9,0x97,0x43,0x90,0xad,0x94,0x1a,0x1f};
    static const ShaderID s_SID_22 = {0xd4,0xce,0xfb,0xc9,0xf6,0xe9,0x9d,0x81,0x73,0xf1,0x8a,0xc1,0xec,0xd3,0xe8,0x10,0x45,0x4f,0x77,0xcd,0x94,0xca,0xd9,0x6c,0x49,0x03,0x13,0x26,0x80,0x33,0x02,0xbd};
    static const ShaderID s_SID_23 = {0x69,0xb7,0xbb,0x2e,0x49,0x55,0xe4,0x05,0x3d,0x5c,0xf1,0x73,0xd9,0xa9,0xfc,0x6e,0x38,0x66,0x1c,0x2d,0x4b,0xf2,0xb6,0xc5,0x38,0x42,0xb4,0x50,0xf5,0x8a,0x1e,0x37};
    static const ShaderID s_SID_24 = {0x31,0x34,0x9d,0x76,0x79,0xc8,0x15,0x34,0x11,0x7d,0x23,0x21,0xcf,0xd3,0x8f,0xc5,0xc5,0xad,0xf6,0x12,0x4c,0x87,0x5b,0x11,0xd3,0xcb,0xfb,0x27,0xf0,0x38,0x70,0x98};
    static const ShaderID s_SID_25 = {0x9c,0x63,0x07,0x37,0x9e,0x7a,0xa8,0xc9,0x6a,0xae,0x93,0x52,0x82,0xb0,0x3d,0x08,0x65,0xeb,0x5d,0x4d,0x38,0x04,0x0d,0xf2,0xa9,0x53,0x11,0x52,0x53,0x58,0x57,0x9d};
    static const ShaderID s_SID_26 = {0xc3,0x58,0x22,0x28,0x40,0xf1,0xe5,0x14,0x7f,0x13,0x48,0x68,0xdc,0xae,0x59,0xda,0xd2,0x17,0xe1,0xb1,0x9a,0x11,0x5d,0xa8,0x66,0x9a,0xd3,0xeb,0x9b,0xd6,0xa2,0xe5};
    static const ShaderID s_SID_27 = {0xf9,0xd0,0x44,0x53,0x55,0xab,0x9c,0x9b,0xa7,0x84,0xef,0xf4,0x65,0xeb,0x0e,0xbf,0x81,0x35,0x3e,0x1c,0xc6,0x31,0x7f,0x46,0xcb,0x16,0xd2,0x00,0x69,0x0c,0xae,0x9d};
#pragma pack (push, 1)

    struct Tags
    {
        static const uint8_t s_Artist = 1;
        static const uint8_t s_Payout = 2;
        static const uint8_t s_Artwork = 4;
        static const uint8_t s_Impression = 5;
        static const uint8_t s_ArtworkHeight = 6;
        static const uint8_t s_ArtistHeight = 7;
        static const uint8_t s_CollectionHeight = 8;
        static const uint8_t s_Collection = 9;
        static const uint8_t s_ArtistCollection = 10;
        static const uint8_t s_CollectionArtwork = 11;
    };

    enum class Role {
        MANAGER,
        ARTIST,
        USER,
    };

    struct ArtistCollectionKey {
        uint8_t m_Tag = Tags::s_ArtistCollection;
        PubKey pkArtist;
        uint32_t collection_id;
    };

    struct CollectionArtworkKey {
        uint8_t m_Tag = Tags::s_CollectionArtwork;
        uint32_t collection_id;
        uint32_t artwork_id;
    };

    template <class T, class ID>
    struct GalleryObject {
        using Id = ID;

        bool Load(const Id& id, size_t object_size = sizeof(T)) {
            typename T::FirstStageKey fsk;
            fsk.id = id; 
            typename T::SecondStageKey ssk;
            ssk.id = id;
            if (!Env::LoadVar_T(fsk, ssk))
                return false;
            return Env::LoadVar(&ssk, sizeof(ssk), this, object_size, KeyTag::Internal);
        }

        bool Save(const Id& id, Height h = Utils::FromBE(Env::get_Height()), size_t object_size = sizeof(T)) {
            typename T::FirstStageKey fsk;
            fsk.id = id; 
            typename T::SecondStageKey ssk;
            ssk.id = id;
            ssk.h_updated = h;
            Env::SaveVar_T(fsk, ssk);
            return Env::SaveVar(&ssk, sizeof(ssk), this, object_size, KeyTag::Internal);
        }

        bool TakeOut(const Id& id, size_t object_size = sizeof(T)) {
            typename T::FirstStageKey fsk;
            fsk.id = id; 
            typename T::SecondStageKey ssk;
            ssk.id = id;
            if (!Env::LoadVar_T(fsk, ssk))
                return false;
            if (!Env::LoadVar(&ssk, sizeof(ssk), this, object_size, KeyTag::Internal))
                return false;
            Env::DelVar_T(ssk);
            return true;
        }

        void Delete(const Id& id) {
            typename T::FirstStageKey fsk;
            fsk.id = id; 
            typename T::SecondStageKey ssk;
            ssk.id = id;
            Env::LoadVar_T(fsk, ssk.h_updated);
            Env::DelVar_T(ssk);
            Env::DelVar_T(fsk);
        }

        bool Exists(const Id& id) {
            typename T::FirstStageKey fsk;
            fsk.id = id; 
            typename T::SecondStageKey ssk;
            return Env::LoadVar_T(fsk, ssk);
        }
    };

    struct Artist : public GalleryObject<Artist, PubKey> {
        struct FirstStageKey {
            uint8_t m_Tag = Tags::s_ArtistHeight;
            Id id;
        };

        struct SecondStageKey {
            uint8_t m_Tag = Tags::s_Artist;
            Id id;
            Height h_updated;
        };

        Height m_hRegistered;
        bool is_approved;
        uint32_t data_len;
        uint32_t label_len;

        // followed by label and data without delimiter
        static const uint32_t s_LabelMaxLen = 120;
        static const uint32_t s_DataMaxLen = 1024;
        static const uint32_t s_TotalMaxLen = s_LabelMaxLen + s_DataMaxLen;
    };

    struct Collection : public GalleryObject<Collection, uint32_t> {
        struct FirstStageKey {
            uint8_t m_Tag = Tags::s_CollectionHeight;
            Id id;
        };

        struct SecondStageKey {
            uint8_t m_Tag = Tags::s_Collection;
            Id id;
            Height h_updated;
        };

        bool is_approved;
        bool is_default;
        uint32_t artworks_num;
        uint32_t data_len;
        uint32_t label_len;
        PubKey m_pkAuthor;
        //Id id;

        // followed by label and data without delimiter
        static const uint32_t s_LabelMaxLen = 120;
        static const uint32_t s_DataMaxLen = 1024;
        static const uint32_t s_TotalMaxLen = s_LabelMaxLen + s_DataMaxLen;
    };

    struct AmountWithAsset {
        Amount m_Amount;
        AssetID m_Aid;
    };

    struct Artwork : public GalleryObject<Artwork, uint32_t> {
        // By this key masterpiece's height with specified ID is accessed 
        // ID ---FistStageKey---> h_updated ---SecondStageKey---> Artwork
        // This is done in order to be able to search for masterpieces updated since specified block
        struct FirstStageKey {
            uint8_t m_Tag = Tags::s_ArtworkHeight;
            Id id;
        };

        struct SecondStageKey {
            uint8_t m_Tag = Tags::s_Artwork;
            Id id;
            Height h_updated;
        };

        PubKey m_pkAuthor;
        PubKey m_pkOwner;
        AssetID m_Aid; // set when it's taken out of gallery
        Collection::Id collection_id;

        AmountWithAsset m_Price;
        static const uint32_t s_LabelMaxLen = 120;
        static const uint32_t s_DataMaxLen = 1024;
        static const uint32_t s_TotalMaxLen = s_LabelMaxLen + s_DataMaxLen;
    };

    struct Impression
    {
        struct ID
        {
            Artwork::Id m_ArtworkID;
            PubKey m_pkUser;
        };

        struct Key
        {
            uint8_t m_Tag = Tags::s_Impression;
            ID m_ID;
        };

        uint32_t m_Value; // 0 = none, 1 = like, etc.
    };

    struct Payout
    {
        struct Key {
            uint8_t m_Tag = Tags::s_Payout;
            PubKey m_pkUser;
            AssetID m_Aid;
            Artwork::Id m_ID;
        };

        Amount m_Amount;
    };

    struct Config
    {
        PubKey m_pkAdmin;
        AmountWithAsset m_VoteReward;
    };

    struct State
    {
        static const uint8_t s_Key = 0;

        Config m_Config;

        struct {
            uint32_t total;
        } artists_stats;

        struct {
            uint32_t total;
            uint32_t free_id;
        } artworks_stats;

        struct {
            uint32_t total;
            uint32_t free_id;
        } collections_stats;

        Amount m_VoteBalance;
    };

    struct Events
    {
        struct AddArtworkData {
            struct Key {
                uint8_t m_Prefix = 0;
                Artwork::Id m_ID;
                PubKey m_pkArtist;
            };
            // data is the exhibit itself
        };

        struct AddArtworkLabel {
            struct Key {
                uint8_t m_Prefix = 1;
                Artwork::Id m_ID;
                PubKey m_pkArtist;
            };
            // data is the exhibit itself
        };

        struct Sell {
            struct Key {
                uint8_t m_Prefix = 1;
                Artwork::Id m_ID;
            };

            AmountWithAsset m_Price;
            uint8_t m_HasAid;
        };
    };

    namespace Method
    {
        struct Init
        {
            static const uint32_t s_iMethod = 0;
            Config m_Config;
        };

        struct ManageArtist
        {
            static const uint32_t s_iMethod = 10;

            enum class RequestType { SET, DISABLE, ENABLE, DELETE } req;
            Gallery::Role role;
            PubKey m_pkArtist;
            uint32_t m_LabelLen; // set Artist::s_LabelMaxLen to remove
            uint32_t m_DataLen;
            // followed by label and data without delimiter
        };

        struct ManageCollection
        {
            static const uint32_t s_iMethod = 15;

            enum class RequestType { SET, DISABLE, ENABLE } req;
            Gallery::Role role;
            PubKey m_pkArtist;
            Collection::Id collection_id;
            uint32_t m_LabelLen;
            uint32_t m_DataLen;
            // followed by label and data without delimiter
        };

        struct AddExhibit
        {
            static const uint32_t s_iMethod = 3;

            enum class RequestType { SET, DISABLE, ENABLE } req;
            Gallery::Role role;
            PubKey m_pkArtist;
            uint32_t data_len;
            uint32_t label_len;
            uint32_t collection_id;
            // followed by the data and label
        };

        struct SetPrice
        {
            static const uint32_t s_iMethod = 4;

            Artwork::Id m_ID;
            AmountWithAsset m_Price;
        };

        struct Buy
        {
            static const uint32_t s_iMethod = 5;

            Artwork::Id m_ID;
            PubKey m_pkUser;
            uint8_t m_HasAid;
            Amount m_PayMax;
        };

        struct Withdraw
        {
            static const uint32_t s_iMethod = 6;

            Payout::Key m_Key;
            Amount m_Value;
        };

        struct CheckPrepare
        {
            static const uint32_t s_iMethod = 7;

            Artwork::Id m_ID;
        };

        struct CheckOut
        {
            static const uint32_t s_iMethod = 8;

            Artwork::Id m_ID;
        };

        struct CheckIn
        {
            static const uint32_t s_iMethod = 9;

            Artwork::Id m_ID;
            PubKey m_pkUser;
        };

        struct Vote
        {
            static const uint32_t s_iMethod = 11;
            Impression::ID m_ID;
            Impression m_Impression;
        };

        struct AddVoteRewards
        {
            static const uint32_t s_iMethod = 12;
            Amount m_Amount;
        };

        struct AdminDelete
        {
            static const uint32_t s_iMethod = 13;
            Artwork::Id m_ID;
        };

        struct Transfer
        {
            static const uint32_t s_iMethod = 14;
            Artwork::Id m_ID;
            PubKey m_pkNewOwner;
        };

    } // namespace Method

#pragma pack (pop)
}
